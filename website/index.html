<!DOCTYPE html>

<HTML>	
	<HEAD>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<link rel="stylesheet" href="style.css" type="text/css" media="all"> 
	</HEAD>
	<BODY onload="Conect()">
		<DIV ID="Logo"></DIV>
		<DIV ID="Title">
				<h1>PROYECTO DE ELECTRÃ“NICA</h1>
		</DIV>
		<DIV ID="Global">
			<h3 >Sensores</h3>
			<DIV ID="Interruption">
				<h3>Estado:</h3>
				<button onclick="Conect(1)">Conectar</button>
				<DIV ID="conect"></DIV>
			</DIV>
			<DIV ID="Sensores">			
					<button onclick="sendmessage(1)">Interruptor 1</button>
					<div id="box"><span id="div10"></span>&nbsp;</div>	
			</DIV>
			<DIV ID="Sensores">				
					<button onclick="sendmessage(2)">Interruptor 2</button>
					<div id="box"><span id="div20"></span>&nbsp;</div>	
			</DIV>
			<DIV ID="Sensores">			
					<button onclick="sendmessage(3)">Interruptor 3</button>
					<div id="box"><span id="div30"></span>&nbsp;</div>	
			</DIV>
			<DIV ID="Sensores">			
					<button onclick="sendmessage(4)">Interruptor 4</button>
					<div id="box"><span id="div40"></span>&nbsp;</div>	
			</DIV>
		</DIV>		
		<SCRIPT TYPE="text/javascript">
		 var ip = location.host;
		 //alert(ip);

		    var divid = 1;
		    var wsUri = 'ws://'+ip+'/xbee';
		    var output;
 			
 			function Conect() { 
 				output = document.getElementById("conect"); ConectWebSocket();
 				}  
 			function ConectWebSocket() { 
 				conect = new WebSocket(wsUri); 
 				conect.onopen = function(evt) { output.innerHTML = '<span style="color: black;">CONECTADO</span>' }; 
 				conect.onclose = function(evt) {output.innerHTML = '<span style="color: orange;">DESCONECTADO: '+evt+'</span>'};
 				conect.onmessage = function(evt) {onMessage(evt.data)}; //get a message
 				conect.onerror = function(evt) { output.innerHTML = '<span style="color: red;">ERROR</span>' }; //error.
 			} 
 			function Discontect(){
 				conect.close(); //close websocket
 			}
 			function onMessage(evt){
				 
 				var print
 				var aux
				var chaine = evt;
				chaine = chaine.split(':');
				aux = 'div'+chaine[0]+'0';
				print = document.getElementById(aux);	
				//print.innerHTML = chaine[1];
				if (chaine[1] == 'OFF') {print.innerHTML ='<span style="color: red;">OFF</span>' }
				else {print.innerHTML = '<span style="color: green;">ON</span>'}
					
				
 			}
 			function sendmessage(id){			
				conect.send(id);
			}
		
		</SCRIPT>
	</BODY>
</HTML>
